<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales Report Scanner</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tesseract.js/2.1.0/tesseract.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        video { width: 80%; margin: 20px auto; display: block; }
        canvas { display: none; }
        #scanner-box {
            position: absolute;
            border: 2px solid red;
            resize: both;
            overflow: hidden;
            width: 200px;
            height: 100px;
            top: 50px;
            left: 50px;
        }
        table { width: 80%; margin: 20px auto; border-collapse: collapse; }
        th, td { border: 1px solid black; padding: 8px; text-align: center; cursor: pointer; }
        th { background-color: #f2f2f2; }
        td { contenteditable: true; }
    </style>
</head>
<body>
    <h2>Sales Report Scanner</h2>
    <video id="camera" autoplay></video>
    <div id="scanner-box" contenteditable="true"></div>
    <button onclick="captureImage()">Scan Table</button>
    <canvas id="canvas"></canvas>
    <br><br>
    <table id="salesTable">
        <thead>
            <tr><th>Column 1</th><th>Column 2</th></tr>
        </thead>
        <tbody id="tableBody"></tbody>
    </table>
    <button onclick="calculateSum()">Calculate Sum</button>
    <button onclick="applyMultiplier()">Apply Multiplier</button>
    <br><br>
    <p id="result"></p>
    <script>
        const video = document.getElementById('camera');
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
            .then(stream => video.srcObject = stream)
            .catch(err => console.error("Camera access error:", err));

        function captureImage() {
            const scannerBox = document.getElementById('scanner-box');
            const boxRect = scannerBox.getBoundingClientRect();
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, boxRect.left, boxRect.top, boxRect.width, boxRect.height, 0, 0, boxRect.width, boxRect.height);
            canvas.toBlob(blob => {
                Tesseract.recognize(blob, 'eng', { logger: m => console.log(m) })
                    .then(({ data: { text } }) => parseTextToTable(text));
            });
        }
        
        function parseTextToTable(text) {
            const lines = text.split('\n');
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            lines.forEach(line => {
                const values = line.match(/\d+(\.\d+)?/g);
                if (values && values.length >= 2) {
                    const row = `<tr><td contenteditable="true">${parseFloat(values[0]) || 0}</td><td contenteditable="true">${parseFloat(values[1]) || 0}</td></tr>`;
                    tableBody.innerHTML += row;
                }
            });
        }
        
        function calculateSum() {
            let sum1 = 0, sum2 = 0;
            document.querySelectorAll('#salesTable tbody tr').forEach(row => {
                const cols = row.getElementsByTagName('td');
                sum1 += parseFloat(cols[0].textContent) || 0;
                sum2 += parseFloat(cols[1].textContent) || 0;
            });
            
            const newRow = `<tr style="font-weight:bold;"><td>${sum1}</td><td>${sum2}</td></tr>`;
            document.getElementById('tableBody').innerHTML += newRow;
            document.getElementById('result').innerText = `Sum: ${sum1} and ${sum2}`;
        }
        
        function applyMultiplier() {
            const multiplier = prompt("Enter multiplier (e.g., 2)");
            if (!multiplier || isNaN(multiplier)) return;
            
            let lastRow = document.querySelector('#salesTable tbody tr:last-child');
            const cols = lastRow.getElementsByTagName('td');
            cols[0].textContent = parseFloat(cols[0].textContent) * multiplier;
            cols[1].textContent = parseFloat(cols[1].textContent) * multiplier;
            document.getElementById('result').innerText += ` | After Multiplier: ${cols[0].textContent} and ${cols[1].textContent}`;
        }
    </script>
</body>
</html>
